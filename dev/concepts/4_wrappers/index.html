<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Extending the models · COBREXA.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="COBREXA.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="COBREXA.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">COBREXA.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../quickstart/">COBREXA.jl in 10 minutes</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/">Contents</a></li><li><a class="tocitem" href="../../examples/01_loading/">Loading models</a></li><li><a class="tocitem" href="../../examples/02_convert_save/">Converting, modifying and saving models</a></li><li><a class="tocitem" href="../../examples/03_exploring/">Exploring model contents</a></li><li><a class="tocitem" href="../../examples/03b_accessors/">Generic accessors</a></li><li><a class="tocitem" href="../../examples/04_core_model/"><code>CoreModel</code> usage</a></li><li><a class="tocitem" href="../../examples/04_standardmodel/">Basic usage of <code>StandardModel</code></a></li><li><a class="tocitem" href="../../examples/04b_standardmodel_construction/">Model construction and modification</a></li><li><a class="tocitem" href="../../examples/05a_fba/">Flux balance analysis (FBA)</a></li><li><a class="tocitem" href="../../examples/05b_fba_mods/">Extending FBA with modifications</a></li><li><a class="tocitem" href="../../examples/06_fva/">Flux variability analysis (FVA)</a></li><li><a class="tocitem" href="../../examples/07_gene_deletion/">Gene knockouts</a></li><li><a class="tocitem" href="../../examples/07_restricting_reactions/">Restricting and disabling individual reactions</a></li><li><a class="tocitem" href="../../examples/08_pfba/">Parsimonious flux balance analysis (pFBA)</a></li><li><a class="tocitem" href="../../examples/09_loopless/">Loopless FBA</a></li><li><a class="tocitem" href="../../examples/10_crowding/">FBA with crowding</a></li><li><a class="tocitem" href="../../examples/11_growth/">Growth media analysis</a></li><li><a class="tocitem" href="../../examples/12_mmdf/">Maximum-minimum driving force analysis</a></li><li><a class="tocitem" href="../../examples/13_moma/">Minimization of metabolic adjustment (MOMA)</a></li><li><a class="tocitem" href="../../examples/14_smoment/">sMOMENT</a></li><li><a class="tocitem" href="../../examples/15_gecko/">GECKO</a></li><li><a class="tocitem" href="../../examples/16_hit_and_run/">Hit and run sampling</a></li><li><a class="tocitem" href="../../examples/17_envelopes/">Production envelopes</a></li></ul></li><li><span class="tocitem">Parallel, distributed and HPC processing</span><ul><li><a class="tocitem" href="../../distributed/">Contents</a></li><li><a class="tocitem" href="../../distributed/1_functions/">Parallel processing overview</a></li><li><a class="tocitem" href="../../distributed/2_parallel/">Local parallel processing</a></li><li><a class="tocitem" href="../../distributed/3_slurm/">Working in a HPC environment</a></li><li><a class="tocitem" href="../../distributed/4_serialized/">Faster model distribution</a></li></ul></li><li><span class="tocitem">Core concepts guide</span><ul><li><a class="tocitem" href="../">Contents</a></li><li><a class="tocitem" href="../1_screen/">Screening many model variants</a></li><li><a class="tocitem" href="../2_modifications/">Writing custom optimizer modifications</a></li><li><a class="tocitem" href="../3_custom_models/">Working with custom models</a></li><li class="is-active"><a class="tocitem" href>Extending the models</a><ul class="internal"><li><a class="tocitem" href="#Writing-a-model-wrapper"><span>Writing a model wrapper</span></a></li><li><a class="tocitem" href="#Example-1:-Slower-model"><span>Example 1: Slower model</span></a></li><li><a class="tocitem" href="#Example-2:-Leaky-model"><span>Example 2: Leaky model</span></a></li><li><a class="tocitem" href="#Example-3:-Combining-the-wrappers"><span>Example 3: Combining the wrappers</span></a></li></ul></li></ul></li><li><span class="tocitem">Reference (Functions and types)</span><ul><li><a class="tocitem" href="../../functions/">Contents</a></li><li><a class="tocitem" href="../../functions/analysis/">Analysis functions</a></li><li><a class="tocitem" href="../../functions/base/">Base functions</a></li><li><a class="tocitem" href="../../functions/io/">Input and output</a></li><li><a class="tocitem" href="../../functions/reconstruction/">Model construction functions</a></li><li><a class="tocitem" href="../../functions/types/">Types</a></li><li><a class="tocitem" href="../../functions/utils/">Utilities</a></li></ul></li><li><a class="tocitem" href="../../howToContribute/">How to contribute</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Core concepts guide</a></li><li class="is-active"><a href>Extending the models</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Extending the models</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/lcsb-biocore/COBREXA.jl/blob/master/docs/src/concepts/4_wrappers.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Extending-the-models"><a class="docs-heading-anchor" href="#Extending-the-models">Extending the models</a><a id="Extending-the-models-1"></a><a class="docs-heading-anchor-permalink" href="#Extending-the-models" title="Permalink"></a></h1><p>To simplify doing (and undoing) simple modifications to the existing model structure, COBREXA.jl supports a class of model <em>wrappers</em>, which are basically small layers that add or change the functionality of a given base models.</p><p>Types <a href="../../functions/types/#COBREXA.Serialized"><code>Serialized</code></a>, <a href="../../functions/types/#COBREXA.CoreCoupling"><code>CoreCoupling</code></a>, <a href="../../functions/types/#COBREXA.SMomentModel"><code>SMomentModel</code></a>, and <a href="../../functions/types/#COBREXA.GeckoModel"><code>GeckoModel</code></a> all work in this manner – add some extra functionality to the &quot;base&quot;. Technically, they are all subtypes of the abstract type <a href="../../functions/types/#COBREXA.ModelWrapper"><code>ModelWrapper</code></a>, which itself is a subtype of <a href="../../functions/types/#COBREXA.MetabolicModel"><code>MetabolicModel</code></a> and can thus be used in all standard analysis functions.  Similarly, the model wraps can be stacked – it is easy to e.g. serialize a <a href="../../functions/types/#COBREXA.GeckoModel"><code>GeckoModel</code></a>, or to add coupling to an existing <a href="../../functions/types/#COBREXA.SMomentModel"><code>SMomentModel</code></a>.</p><p>As the main benefit of the approach, creating model variants using the wrapper approach is usually more efficient than recomputing the models in place. The wrappers are thin, and if all values can get computed and materialized only once the model data is actually needed, we may save a great amount of computing power.</p><p>At the same time, since the original model stays unchanged (and may even be immutable), undoing the modifications caused by the wrapper is extremely easy and fast – we just discard the wrapper.</p><h2 id="Writing-a-model-wrapper"><a class="docs-heading-anchor" href="#Writing-a-model-wrapper">Writing a model wrapper</a><a id="Writing-a-model-wrapper-1"></a><a class="docs-heading-anchor-permalink" href="#Writing-a-model-wrapper" title="Permalink"></a></h2><p>Creating a model wrapper structure is simple – by declaring it a subtype of <a href="../../functions/types/#COBREXA.ModelWrapper"><code>ModelWrapper</code></a> and implementing a single function <a href="../../functions/types/#COBREXA.unwrap_model-Tuple{CoreCoupling}"><code>unwrap_model</code></a>, we get default implementations of all accessors that should work for any <a href="../../functions/types/#COBREXA.MetabolicModel"><code>MetabolicModel</code></a>.</p><p>As a technical example, we may make a minimal model wrapper that does not do anything:</p><pre><code class="language-julia">struct IdentityWrap &lt;: ModelWrapper
    mdl::MetabolicModel
end

COBREXA.unwrap_model(x::IdentityWrap) = x.mdl</code></pre><p>This is instantly usable in all analysis functions, although there is no actual &quot;new&quot; functionality:</p><pre><code class="language-julia">m = IdentityWrap(load_model(&quot;e_coli_core.xml&quot;))
flux_balance_analysis_vec(m, GLPK.Optimizer)</code></pre><p>To modify the functionality, we simply add specific methods for accessors that we want modified, such as <a href="../../functions/types/#COBREXA.bounds-Tuple{CoreModel}"><code>bounds</code></a>, <a href="../../functions/types/#COBREXA.stoichiometry-Tuple{CoreModel}"><code>stoichiometry</code></a> and <a href="../../functions/types/#COBREXA.objective-Tuple{CoreModel}"><code>objective</code></a>. We demonstrate that on several examples below.</p><h2 id="Example-1:-Slower-model"><a class="docs-heading-anchor" href="#Example-1:-Slower-model">Example 1: Slower model</a><a id="Example-1:-Slower-model-1"></a><a class="docs-heading-anchor-permalink" href="#Example-1:-Slower-model" title="Permalink"></a></h2><p>Here, we construct a type <code>RateChangedModel</code> that has all bounds multiplied by a constant factor. This can be used to e.g. simulate higher or lower abundance of certain organism in a model.</p><pre><code class="language-julia">struct RateChangedModel &lt;: ModelWrapper
    factor::Float64
    mdl::MetabolicModel
end</code></pre><p>The overloaded accessors typically reach for basic information into the &quot;inner&quot; wrapped model, and modify them in a certain way.</p><pre><code class="language-julia">COBREXA.unwrap_model(x::RateChangedModel) = x.mdl
function COBREXA.bounds(x::RateChangedModel)
    (l, u) = bounds(x.mdl) # extract the original bounds
    return (l .* x.factor, u .* x.factor) # return customized bounds
end</code></pre><p>To make a 2 times faster or slower model from a base model, we can run:</p><pre><code class="language-julia">faster_e_coli = RateChangedModel(2.0, load_model(&quot;e_coli_core.xml&quot;))
slower_e_coli = RateChangedModel(1/2, load_model(&quot;e_coli_core.xml&quot;))</code></pre><h2 id="Example-2:-Leaky-model"><a class="docs-heading-anchor" href="#Example-2:-Leaky-model">Example 2: Leaky model</a><a id="Example-2:-Leaky-model-1"></a><a class="docs-heading-anchor-permalink" href="#Example-2:-Leaky-model" title="Permalink"></a></h2><p>As the second example, we construct a hypothetical model that is &quot;leaking&quot; all metabolites at once at a constant fixed small rate. Again, the modification is not quite realistic, but may be useful to validate the mathematical robustness of the models.</p><pre><code class="language-julia">struct LeakyModel &lt;: ModelWrapper
    leaking_metabolites::Vector{String}
    leak_rate::Float64
    mdl::MetabolicModel
end</code></pre><p>Technically, we implement the leaks by adding an extra reaction bounded to the precise <code>leak_rate</code>, which permanently removes all metabolites. That is done by modifying the reaction list, stoichiometry, and bounds:</p><pre><code class="language-julia">COBREXA.unwrap_model(x::LeakyModel) = x.mdl
COBREXA.n_reactions(x::LeakyModel) = n_reactions(x.mdl) + 1
COBREXA.reactions(x::LeakyModel) = [reactions(x.mdl); &quot;The Leak&quot;]
COBREXA.stoichiometry(x::LeakyModel) = [stoichiometry(x.mdl) [m in x.leaking_metabolites ? -1.0 : 0.0 for m = metabolites(x.mdl)]]
function COBREXA.bounds(x::LeakyModel)
    (l, u) = bounds(x.mdl)
    return ([l; x.leak_rate], [u; x.leak_rate])
end</code></pre><p>To make the wrapper complete and consistent, we also have to modify the accessors that depend on correct sizes of the model items.</p><pre><code class="language-julia">COBREXA.objective(x::LeakyModel) = [objective(x.mdl); 0]
COBREXA.reaction_flux(x::LeakyModel) = [reaction_flux(x.mdl); zeros(1, n_reactions(x.mdl))]
COBREXA.coupling(x::LeakyModel) = [coupling(x.mdl) zeros(n_coupling_constraints(x.mdl))]</code></pre><p>(Among other, we modified the <a href="../../functions/types/#COBREXA.reaction_flux-Tuple{MetabolicModel}"><code>reaction_flux</code></a> so that all analysis methods ignore the leak reaction.)</p><p>Now, any model can be made to lose some chosen metabolites as follows:</p><pre><code class="language-julia">leaks = [&quot;M_o2_c&quot;, &quot;M_pi_c&quot;, &quot;M_glx_c&quot;]
leaky_e_coli = LeakyModel(leaks, 5, load_model(&quot;e_coli_core.xml&quot;))</code></pre><h2 id="Example-3:-Combining-the-wrappers"><a class="docs-heading-anchor" href="#Example-3:-Combining-the-wrappers">Example 3: Combining the wrappers</a><a id="Example-3:-Combining-the-wrappers-1"></a><a class="docs-heading-anchor-permalink" href="#Example-3:-Combining-the-wrappers" title="Permalink"></a></h2><p>With both wrappers implemented individually, it is easy to combine them by re-wrapping. We can easily create a model that is slowed down and moreover leaks the metabolites as follows:</p><pre><code class="language-julia">leaky_slow_e_coli = LeakyModel(leaks, 5, RateChangedModel(1/2, load_model(&quot;e_coli_core.xml&quot;)))</code></pre><p>As with all wrapping operations, take care about the exact order of applying the wraps. The other combination of the model wraps differs by also changing the rate of the metabolite leaks, which did not happen with the <code>leaky_slow_e_coli</code> above:</p><pre><code class="language-julia">slowly_leaking_slow_e_coli = RateChangedModel(1/2, LeakyModel(leaks, 5, load_model(&quot;e_coli_core.xml&quot;)))</code></pre><p>Expectably, the model can be solved with standard functions:</p><pre><code class="language-julia">v = flux_balance_analysis_dict(slowly_leaking_slow_e_coli, GLPK.Optimizer)
v[&quot;R_BIOMASS_Ecoli_core_w_GAM&quot;]  # prints out ~0.38</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../3_custom_models/">« Working with custom models</a><a class="docs-footer-nextpage" href="../../functions/">Contents »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 31 October 2023 12:24">Tuesday 31 October 2023</span>. Using Julia version 1.8.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
