<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Working in a HPC environment · COBREXA.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="COBREXA.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="COBREXA.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">COBREXA.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../quickstart/">COBREXA.jl in 10 minutes</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/">Contents</a></li><li><a class="tocitem" href="../../examples/01_loading/">Loading models</a></li><li><a class="tocitem" href="../../examples/02_convert_save/">Converting, modifying and saving models</a></li><li><a class="tocitem" href="../../examples/03_exploring/">Exploring model contents</a></li><li><a class="tocitem" href="../../examples/03b_accessors/">Generic accessors</a></li><li><a class="tocitem" href="../../examples/04_core_model/"><code>CoreModel</code> usage</a></li><li><a class="tocitem" href="../../examples/04_standardmodel/">Basic usage of <code>StandardModel</code></a></li><li><a class="tocitem" href="../../examples/04b_standardmodel_construction/">Model construction and modification</a></li><li><a class="tocitem" href="../../examples/05a_fba/">Flux balance analysis (FBA)</a></li><li><a class="tocitem" href="../../examples/05b_fba_mods/">Extending FBA with modifications</a></li><li><a class="tocitem" href="../../examples/06_fva/">Flux variability analysis (FVA)</a></li><li><a class="tocitem" href="../../examples/07_gene_deletion/">Gene knockouts</a></li><li><a class="tocitem" href="../../examples/07_restricting_reactions/">Restricting and disabling individual reactions</a></li><li><a class="tocitem" href="../../examples/08_pfba/">Parsimonious flux balance analysis (pFBA)</a></li><li><a class="tocitem" href="../../examples/09_loopless/">Loopless FBA</a></li><li><a class="tocitem" href="../../examples/10_crowding/">FBA with crowding</a></li><li><a class="tocitem" href="../../examples/11_growth/">Growth media analysis</a></li><li><a class="tocitem" href="../../examples/12_mmdf/">Maximum-minimum driving force analysis</a></li><li><a class="tocitem" href="../../examples/13_moma/">Minimization of metabolic adjustment (MOMA)</a></li><li><a class="tocitem" href="../../examples/14_smoment/">sMOMENT</a></li><li><a class="tocitem" href="../../examples/15_gecko/">GECKO</a></li><li><a class="tocitem" href="../../examples/16_hit_and_run/">Hit and run sampling</a></li><li><a class="tocitem" href="../../examples/17_envelopes/">Production envelopes</a></li></ul></li><li><span class="tocitem">Parallel, distributed and HPC processing</span><ul><li><a class="tocitem" href="../">Contents</a></li><li><a class="tocitem" href="../1_functions/">Parallel processing overview</a></li><li><a class="tocitem" href="../2_parallel/">Local parallel processing</a></li><li class="is-active"><a class="tocitem" href>Working in a HPC environment</a><ul class="internal"><li><a class="tocitem" href="#Interacting-with-Slurm"><span>Interacting with Slurm</span></a></li><li><a class="tocitem" href="#Wrapping-your-script-in-a-Slurm-batch-job"><span>Wrapping your script in a Slurm batch job</span></a></li></ul></li><li><a class="tocitem" href="../4_serialized/">Faster model distribution</a></li></ul></li><li><span class="tocitem">Core concepts guide</span><ul><li><a class="tocitem" href="../../concepts/">Contents</a></li><li><a class="tocitem" href="../../concepts/1_screen/">Screening many model variants</a></li><li><a class="tocitem" href="../../concepts/2_modifications/">Writing custom optimizer modifications</a></li><li><a class="tocitem" href="../../concepts/3_custom_models/">Working with custom models</a></li><li><a class="tocitem" href="../../concepts/4_wrappers/">Extending the models</a></li></ul></li><li><span class="tocitem">Reference (Functions and types)</span><ul><li><a class="tocitem" href="../../functions/">Contents</a></li><li><a class="tocitem" href="../../functions/analysis/">Analysis functions</a></li><li><a class="tocitem" href="../../functions/base/">Base functions</a></li><li><a class="tocitem" href="../../functions/io/">Input and output</a></li><li><a class="tocitem" href="../../functions/reconstruction/">Model construction functions</a></li><li><a class="tocitem" href="../../functions/types/">Types</a></li><li><a class="tocitem" href="../../functions/utils/">Utilities</a></li></ul></li><li><a class="tocitem" href="../../howToContribute/">How to contribute</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Parallel, distributed and HPC processing</a></li><li class="is-active"><a href>Working in a HPC environment</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Working in a HPC environment</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/lcsb-biocore/COBREXA.jl/blob/master/docs/src/distributed/3_slurm.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Working-in-a-HPC-environment"><a class="docs-heading-anchor" href="#Working-in-a-HPC-environment">Working in a HPC environment</a><a id="Working-in-a-HPC-environment-1"></a><a class="docs-heading-anchor-permalink" href="#Working-in-a-HPC-environment" title="Permalink"></a></h1><p>Many researchers have access to institutional HPC facilities that allow time-sharing of the capacity of a large computer cluster between many users. Julia and <code>COBREXA.jl</code> work well within this environment, and the COBREXA analyses usually require only minimal additional customization to be able to find and utilize the resources available from the HPC.</p><p>When executed in a HPC environment, the analysis script must solve several relatively complex tasks:</p><ul><li>It needs to find out how many resources were allocated for the analysis</li><li>It needs to add the remote workers precisely at the allocated places</li></ul><p>Fortunately, the package <a href="https://github.com/JuliaParallel/ClusterManagers.jl"><code>ClusterManagers.jl</code></a> does that for us. For simplicily, here we assume that your HPC is scheduled by <a href="https://slurm.schedmd.com/">Slurm</a>, but other scheduling environments are supported in a very similar way.</p><h2 id="Interacting-with-Slurm"><a class="docs-heading-anchor" href="#Interacting-with-Slurm">Interacting with Slurm</a><a id="Interacting-with-Slurm-1"></a><a class="docs-heading-anchor-permalink" href="#Interacting-with-Slurm" title="Permalink"></a></h2><p>Adding of the Slurm-provided is done as follows:</p><ul><li>you import the <code>ClusterManagers</code> package</li><li>you find how many processes to spawn from the environment from <code>SLURM_NTASKS</code> environment variable</li><li>you use the function <code>addprocs_slurm</code> to precisely connect to your allocated computational resources</li></ul><p>After adding the Slurm workers, you may continue as if the workers were added using normal <code>addprocs</code> –- typically you load the model and (for example) run the <a href="../../functions/analysis/#COBREXA.flux_variability_analysis-Tuple{MetabolicModel, Any}"><code>flux_variability_analysis</code></a> as if you would use the <a href="../2_parallel/">local workers</a>.</p><p>The Julia script that does a parallel analysis in a Slurm cluster may look as follows:</p><pre><code class="language-none">using COBREXA, Distributed, ClusterManagers, GLPK

available_workers = parse(Int, ENV[&quot;SLURM_NTASKS&quot;])

addprocs_slurm(available_workers)

# ... load models, prepare data, etc. ...

result = flux_variability_analysis(...; workers=workers())

# ... save the results into a file ...</code></pre><div class="admonition is-success"><header class="admonition-header">What about the other HPC schedulers?</header><div class="admonition-body"><p><code>ClusterManagers.jl</code> supports many other common HPC scheduling systems, including LFS, Sun Grid, SGE, PBS, and Scyld, in a way almost identical to Slurm. See the <a href="https://github.com/JuliaParallel/ClusterManagers.jl/blob/master/README.md">package documentation</a> for details.</p></div></div><h2 id="Wrapping-your-script-in-a-Slurm-batch-job"><a class="docs-heading-anchor" href="#Wrapping-your-script-in-a-Slurm-batch-job">Wrapping your script in a Slurm batch job</a><a id="Wrapping-your-script-in-a-Slurm-batch-job-1"></a><a class="docs-heading-anchor-permalink" href="#Wrapping-your-script-in-a-Slurm-batch-job" title="Permalink"></a></h2><p>To be able to submit your script for later processing using the <a href="https://slurm.schedmd.com/sbatch.html"><code>sbatch</code> Slurm command</a>, you need to wrap it in a small &quot;batch&quot; script that tells Slurm how many resources the process needs.</p><p>Assuming you have a Julia computation script written down in <code>myJob.jl</code> and saved on your HPC cluster&#39;s access node, the corresponding Slurm batch script (let&#39;s call it <code>myJob.sbatch</code>) may look as follows:</p><pre><code class="language-sh">#!/bin/bash -l
#SBATCH -n 100           # the job will require 100 individual workers
#SBATCH -c 1             # each worker will sit on a single CPU
#SBATCH -t 30            # the whole job will take less than 30 minutes
#SBATCH -J myJob         # the name of the job

module load lang/Julia   # this is usually required to make Julia available to your job

julia myJob.jl</code></pre><p>To run the computation, simply run <code>sbatch myJob.sbatch</code> on the cluster access node.  The job will be scheduled and eventually executed. You may watch the output of commands <code>sacct</code> and <code>squeue</code> in the meantime, to see the progress.</p><p>Remember that you need to explicitly save the result of your Julia script computation to files, to be able to retrieve them later. Standard outputs of the jobs are often mangled and discarded. If you still want to collect the standard output of your Julia script, you may change the last line of the batch script to</p><pre><code class="language-sh">julia myJob.jl &gt; myJob.log</code></pre><p>and collect the output from <code>myJob.log</code> later. This is convenient especially if your script logs various computation details using <code>@info</code> and similar macros.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../2_parallel/">« Local parallel processing</a><a class="docs-footer-nextpage" href="../4_serialized/">Faster model distribution »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 13 February 2023 11:16">Monday 13 February 2023</span>. Using Julia version 1.8.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
